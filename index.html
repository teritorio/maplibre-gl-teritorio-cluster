<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="./teritorio.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta property="og:description"
    content="Allow visualization and interaction with all markers, even when superposed. Can display and interact with small cluster without the need to zoom or uncluster." />
  <title>MapLibre GL Teritorio Cluster</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      margin: 0;
      padding: 0;
    }

    html,
    body,
    #map {
      height: 100%;
    }

    header {
      display: flex;
      padding: 8px;
      width: 100%;
    }
  </style>
</head>

<body>
  <header>
    <input id="custom-url" type="url" placeholder="GeoJSON source URL..." />
    <button id="load-data">Load external data</button>
    <button id="remove-data">Remove external data</button>
    |
    <input id="feature-id" type="text" value="us2000ahxc" />
    <button id="select-feature">Select feature manually</button>
  </header>
  <div id="map"></div>
  <script type="module">
    import maplibregl from 'maplibre-gl'
    import 'maplibre-gl/dist/maplibre-gl.css'
    import { TeritorioClusterLayer } from './src/index'

    let geojson;
    let teritorioCluster;
    const map = new maplibregl.Map({
      hash: true,
      container: "map",
      style: 'https://api.maptiler.com/maps/openstreetmap/style.json?key=hqrbV59Y4PPzIfzhWRGC'
    });

    map.addControl(new maplibregl.NavigationControl());
    map.on('load', async () => {
      geojson = await fetch('https://maplibre.org/maplibre-gl-js/docs/assets/earthquakes.geojson', { method: 'GET' }).then(res => res.json())

      // add a clustered GeoJSON source for a sample set of earthquakes
      map.addSource('earthquakes', {
        'type': 'geojson',
        'data': geojson,
        'cluster': true,
        'clusterRadius': 80,
        'clusterMaxZoom': 22,
        'maxzoom': 24
      })

      map.addLayer(
        new TeritorioClusterLayer(
          'teritorio-layer',
          'earthquakes',
          {
            paint: {
              'circle-color': 'green',
              'circle-radius': 14,
            }
          },
          {
            layout: {
              'text-field': [
                'number-format',
                ['get', 'mag'],
                { 'min-fraction-digits': 1, 'max-fraction-digits': 1 },
              ],
              'text-size': 12,
              'text-font': ['Open Sans Semibold'],
            },
            paint: {
              'text-color': '#FFFFFF',
            },
          },
          {
            paint: {
              'circle-color': '#FFFFFF',
              'circle-radius': 30,
              'circle-stroke-color': 'green',
              'circle-stroke-width': 2
            }
          },
          {
            layout: {
              'text-field': ['to-string', ['get', 'point_count']],
              'text-size': 12,
              'text-font': ['Open Sans Semibold'],
            },
            paint: {
              'text-color': '#000000',
            }
          }
        )
      )
    })
  </script>
</body>

</html>